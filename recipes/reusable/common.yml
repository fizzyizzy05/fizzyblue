---
# yaml-language-server: $schema=https://schema.blue-build.org/recipe-v1.json

# module configuration, executed in order
# you can include multiple instances of the same module
modules:
  - type: files
    files:
      - source: base
        destination: / # copies files/base/* to the root of the container

  - type: dnf
    install:
      packages:
        - micro
        - fish
    remove:
      packages:
        - firefox
        - firefox-langpacks # also remove firefox dependency (not required for all packages, this is a special case)

  - type: dnf
    repos:
      copr:
        - atim/starship
    install:
      packages:
        - starship

  # Install uupd for updates
  - type: dnf
    repos:
      copr:
        - ublue-os/packages
    install:
      packages:
        - uupd

  # Gaming Software
  - type: dnf
    repos:
      files:
        - https://negativo17.org/repos/fedora-multimedia.repo
    install:
      packages:
        - steam
        - lutris
        - mangohud
        - gamescope

  # Development Software
  - type: dnf
    install:
      packages:
        - docker
        - python3-tkinter
        - python3-pip
        - flatpak-builder
        - libvirt
        - libvirt-nss
        - virt-manager
        - foundry

  # Install Visual Studio Code
  - type: dnf
    repos:
      files:
        - https://packages.microsoft.com/yumrepos/vscode/config.repo
    install: 
      packages:
        - code

  # Install Flatpak 1.16.1 to work around https://gitlab.gnome.org/GNOME/gnome-builder/-/issues/2387#note_2637545
  # TODO: remove this once it's been fixed, fizzyblue should not carry this longer than needed.
  - type: script
    snippets:
      - "dnf5 downgrade -y --allow-downgrade flatpak-1.16.1-1.fc43 flatpak-libs-1.16.1-1.fc43 flatpak-session-helper-1.16.1-1.fc43 flatpak-selinux-1.16.1-1.fc43"

  # Remove GNOME Classic & it's related extensions
  - type: dnf
    remove:
      packages:
        - gnome-classic-session
        - gnome-shell-extension-common
        - gnome-shell-extension-apps-menu-
        - gnome-shell-extension-launch-new-instance
        - gnome-shell-extension-places-menu
        - gnome-shell-extension-window-list
        - gnome-shell-extension-background-logo
        - gnome-shell-extension-appindicator

  # Remove other GNOME apps that are replaced with Flatpaks
  - type: dnf
    remove:
      packages:
        - gnome-software
        - gnome-tour
        - gnome-system-monitor
        - yelp

  # Setup the rechunker-group-fix for people coming from images using the old HHD rechunker
  - type: script
    scripts: 
      - rechunker-fix.sh

  # Override default GNOME settings
  - type: gschema-overrides
    include:
    - zz0-fizzyblue.gschema.override

  # Enable services
  - type: systemd
    system:
      enabled:
        - rechunker-group-fix.service
        - docker.service
        - uupd.timer
      disabled:
        - bootc-fetch-apply-updates.timer

  # Install homebrew
  - type: brew

  - type: signing # this sets up the proper policy & signing files for signed images to work fully